<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MeCoin Retrieval</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #000000;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      position: relative;
    }

    .user-avatar {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid #FFD700;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(255,215,0,0.5);
    }

    .container {
      text-align: center;
      max-width: 400px;
      width: 100%;
    }

    .score {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 30px;
      text-shadow: 0 0 10px rgba(255,215,0,0.5);
      color: #FFD700;
    }

    .coin-button {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #FFD700, #D4AF37, #B8860B);
      border: 4px solid #FFD700;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      color: #8B7500;
      box-shadow:
        0 0 30px rgba(255,215,0,0.5),
        inset 0 0 20px rgba(255,255,255,0.3);
      transition: all 0.1s ease;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .coin-button:before {
      content: '';
      position: absolute;
      top: 10%;
      left: 10%;
      right: 10%;
      bottom: 10%;
      background: radial-gradient(ellipse at center, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);
      border-radius: 50%;
    }

    .coin-button:after {
      content: '‚Çø';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 60px;
      color: #8B7500;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .coin-button.diamond:after { content: 'üíé'; color: #b9f2ff; }
    .coin-button.ruby:after { content: 'üî¥'; color: #e0115f; }
    .coin-button.emerald:after { content: 'üíö'; color: #50c878; }
    .coin-button.bitcoin:after { content: '‚Çø'; color: #ff9900; }
    .coin-button.crown:after { content: 'üëë'; color: #ffd700; }

    .coin-button:active {
      transform: scale(0.95) rotate(5deg);
      box-shadow:
        0 0 15px rgba(255,215,0,0.3),
        inset 0 0 10px rgba(255,255,255,0.2);
    }

    .stats {
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(10px);
      margin-top: 20px;
      border: 1px solid rgba(255,215,0,0.3);
    }

    .stats p {
      margin: 10px 0;
      font-size: 18px;
      color: #FFD700;
    }

    h1 {
      margin-bottom: 30px;
      text-shadow: 0 0 10px rgba(255,215,0,0.5);
      color: #FFD700;
      font-size: 28px;
    }

    .reset-button {
      background: linear-gradient(145deg, #FFD700, #D4AF37);
      border: none;
      color: #000;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255,215,0,0.3);
    }

    .reset-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255,215,0,0.4);
    }

    .stats span {
      color: white;
      font-weight: bold;
    }

    .shop-button {
      background: linear-gradient(145deg, #4CAF50, #45a049);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(76,175,80,0.3);
    }

    .roulette-button {
      background: linear-gradient(145deg, #9C27B0, #7B1FA2);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(156,39,176,0.3);
    }

    .chart-button {
      background: linear-gradient(145deg, #2196F3, #1976D2);
      border: none;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(33,150,243,0.3);
    }

    .shop-button:hover, .roulette-button:hover, .chart-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1a1a1a;
      padding: 30px;
      border-radius: 20px;
      border: 2px solid #FFD700;
      max-width: 350px;
      width: 90%;
      text-align: center;
      max-height: 80vh;
      overflow-y: auto;
    }

    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      color: #FFD700;
      cursor: pointer;
      background: none;
      border: none;
    }

    .shop-item {
      background: rgba(255,255,255,0.1);
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid rgba(255,215,0,0.3);
    }

    .buy-button {
      background: linear-gradient(145deg, #FFD700, #D4AF37);
      border: none;
      color: #000;
      padding: 8px 16px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      margin-top: 8px;
      transition: all 0.3s ease;
    }

    .buy-button:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .buy-button:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    .boost-info {
      font-size: 14px;
      color: #aaa;
      margin-top: 5px;
    }

    .buttons-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
    }

    .skin-preview {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin: 5px auto;
      border: 2px solid #FFD700;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .roulette-prize {
      font-size: 24px;
      margin: 10px 0;
      padding: 10px;
      background: rgba(255,215,0,0.2);
      border-radius: 10px;
      border: 1px solid #FFD700;
    }

    .owned {
      color: #4CAF50;
      font-weight: bold;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ */
    .chart-container {
      width: 100%;
      height: 200px;
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      margin: 15px 0;
      padding: 10px;
      position: relative;
      overflow: hidden;
    }

    .chart-canvas {
      width: 100%;
      height: 100%;
    }

    .chart-info {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 14px;
    }

    .trade-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 15px 0;
    }

    .buy-crypto-button {
      background: linear-gradient(145deg, #4CAF50, #45a049);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .sell-crypto-button {
      background: linear-gradient(145deg, #f44336, #d32f2f);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .price-up {
      color: #4CAF50;
    }

    .price-down {
      color: #f44336;
    }

    .settings-item {
      margin: 15px 0;
      text-align: left;
    }

    .settings-item label {
      display: block;
      margin-bottom: 5px;
      color: #FFD700;
    }

    .settings-item input {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #FFD700;
      background: rgba(255,255,255,0.1);
      color: white;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- –ê–≤–∞—Ç–∞—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <img src="" class="user-avatar" id="userAvatar" style="display: none;">
  <div class="user-avatar" id="defaultAvatar" style="background: #FFD700; display: flex; align-items: center; justify-content: center; font-size: 24px;">üë§</div>

  <h1>MeCoin Retrieval</h1>

  <div class="score" id="score">0 –º–æ–Ω–µ—Ç</div>

  <button class="coin-button" id="tapButton"></button>

  <div class="buttons-row">
    <button class="shop-button" id="shopButton">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
    <button class="roulette-button" id="rouletteButton">üé∞ –†—É–ª–µ—Ç–∫–∞</button>
    <button class="chart-button" id="chartButton">üìà –ì—Ä–∞—Ñ–∏–∫</button>
    <button class="reset-button" id="resetButton">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <div class="stats">
    <p>–£—Å–∏–ª–∏—Ç–µ–ª—å: <span id="boostLevel">1x</span></p>
    <p>–ú–æ–Ω–µ—Ç–∫–∏: <span id="coins">0</span> ü™ô</p>
    <p>–ö—Ä–∏–ø—Ç–∞: <span id="cryptoAmount">0</span> MEC</p>
    <p>–¢–µ–∫—É—â–∏–π —Å–∫–∏–Ω: <span id="currentSkin">–û–±—ã—á–Ω—ã–π</span></p>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞–≥–∞–∑–∏–Ω–∞ -->
<div class="modal" id="shopModal">
  <div class="modal-content">
    <button class="close-button" id="closeShop">&times;</button>
    <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
    
    <h3>‚ö° –£—Å–∏–ª–∏—Ç–µ–ª–∏</h3>
    <div class="shop-item">
      <h4>–£—Å–∏–ª–∏—Ç–µ–ª—å x2</h4>
      <p>–î–∞–µ—Ç 2 –º–æ–Ω–µ—Ç–∫–∏ –∑–∞ –∫–ª–∏–∫</p>
      <p class="boost-info">–¶–µ–Ω–∞: 1,000 ü™ô</p>
      <button class="buy-button" id="buyBoost2">–ö—É–ø–∏—Ç—å –∑–∞ 1,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <h4>–£—Å–∏–ª–∏—Ç–µ–ª—å x5</h4>
      <p>–î–∞–µ—Ç 5 –º–æ–Ω–µ—Ç–æ–∫ –∑–∞ –∫–ª–∏–∫</p>
      <p class="boost-info">–¶–µ–Ω–∞: 5,000 ü™ô</p>
      <button class="buy-button" id="buyBoost5">–ö—É–ø–∏—Ç—å –∑–∞ 5,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <h4>–£—Å–∏–ª–∏—Ç–µ–ª—å x10</h4>
      <p>–î–∞–µ—Ç 10 –º–æ–Ω–µ—Ç–æ–∫ –∑–∞ –∫–ª–∏–∫</p>
      <p class="boost-info">–¶–µ–Ω–∞: 10,000 ü™ô</p>
      <button class="buy-button" id="buyBoost10">–ö—É–ø–∏—Ç—å –∑–∞ 10,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <h4>–£—Å–∏–ª–∏—Ç–µ–ª—å x25</h4>
      <p>–î–∞–µ—Ç 25 –º–æ–Ω–µ—Ç–æ–∫ –∑–∞ –∫–ª–∏–∫</p>
      <p class="boost-info">–¶–µ–Ω–∞: 25,000 ü™ô</p>
      <button class="buy-button" id="buyBoost25">–ö—É–ø–∏—Ç—å –∑–∞ 25,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <h4>–£—Å–∏–ª–∏—Ç–µ–ª—å x50</h4>
      <p>–î–∞–µ—Ç 50 –º–æ–Ω–µ—Ç–æ–∫ –∑–∞ –∫–ª–∏–∫</p>
      <p class="boost-info">–¶–µ–Ω–∞: 50,000 ü™ô</p>
      <button class="buy-button" id="buyBoost50">–ö—É–ø–∏—Ç—å –∑–∞ 50,000 ü™ô</button>
    </div>

    <h3>üé® –°–∫–∏–Ω—ã</h3>
    <div class="shop-item">
      <div class="skin-preview" style="background: radial-gradient(circle at 30% 30%, #b9f2ff, #0890ff, #0055ff);">üíé</div>
      <h4>–ê–ª–º–∞–∑–Ω—ã–π —Å–∫–∏–Ω</h4>
      <p class="boost-info">–¶–µ–Ω–∞: 5,000 ü™ô</p>
      <button class="buy-button" id="buySkinDiamond">–ö—É–ø–∏—Ç—å –∑–∞ 5,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <div class="skin-preview" style="background: radial-gradient(circle at 30% 30%, #ff6b6b, #e0115f, #8b0000);">üî¥</div>
      <h4>–†—É–±–∏–Ω–æ–≤—ã–π —Å–∫–∏–Ω</h4>
      <p class="boost-info">–¶–µ–Ω–∞: 8,000 ü™ô</p>
      <button class="buy-button" id="buySkinRuby">–ö—É–ø–∏—Ç—å –∑–∞ 8,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <div class="skin-preview" style="background: radial-gradient(circle at 30% 30%, #50c878, #228b22, #006400);">üíö</div>
      <h4>–ò–∑—É–º—Ä—É–¥–Ω—ã–π —Å–∫–∏–Ω</h4>
      <p class="boost-info">–¶–µ–Ω–∞: 12,000 ü™ô</p>
      <button class="buy-button" id="buySkinEmerald">–ö—É–ø–∏—Ç—å –∑–∞ 12,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <div class="skin-preview" style="background: radial-gradient(circle at 30% 30%, #ff9900, #ff6600, #cc5500);">‚Çø</div>
      <h4>–ë–∏—Ç–∫–æ–∏–Ω —Å–∫–∏–Ω</h4>
      <p class="boost-info">–¶–µ–Ω–∞: 20,000 ü™ô</p>
      <button class="buy-button" id="buySkinBitcoin">–ö—É–ø–∏—Ç—å –∑–∞ 20,000 ü™ô</button>
    </div>

    <div class="shop-item">
      <div class="skin-preview" style="background: radial-gradient(circle at 30% 30%, #ffd700, #ffa500, #ff8c00);">üëë</div>
      <h4>–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π —Å–∫–∏–Ω</h4>
      <p class="boost-info">–¶–µ–Ω–∞: 50,000 ü™ô</p>
      <button class="buy-button" id="buySkinCrown">–ö—É–ø–∏—Ç—å –∑–∞ 50,000 ü™ô</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä—É–ª–µ—Ç–∫–∏ -->
<div class="modal" id="rouletteModal">
  <div class="modal-content">
    <button class="close-button" id="closeRoulette">&times;</button>
    <h2>üé∞ –†—É–ª–µ—Ç–∫–∞</h2>
    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å —Å–ø–∏–Ω–∞: 500 ü™ô</p>
    <p>–®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞ —Å–∫–∏–Ω–∞: 10%</p>
    
    <button class="roulette-button" id="spinButton" style="font-size: 20px; padding: 15px 30px;">üé∞ –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É!</button>
    
    <div id="rouletteResult"></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≥—Ä–∞—Ñ–∏–∫–∞ -->
<div class="modal" id="chartModal">
  <div class="modal-content">
    <button class="close-button" id="closeChart">&times;</button>
    <h2>üìà –ì—Ä–∞—Ñ–∏–∫ MEC/USD</h2>
    
    <div class="chart-info">
      <div>–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: <span id="currentPrice">1.00</span> USD</div>
      <div>–ò–∑–º–µ–Ω–µ–Ω–∏–µ: <span id="priceChange">0.00</span>%</div>
    </div>
    
    <div class="chart-container">
      <canvas id="priceChart" class="chart-canvas"></canvas>
    </div>
    
    <div class="chart-info">
      <div>–í–∞—à –±–∞–ª–∞–Ω—Å: <span id="cryptoBalance">0</span> MEC</div>
      <div>–°—Ç–æ–∏–º–æ—Å—Ç—å: <span id="cryptoValue">0.00</span> USD</div>
    </div>
    
    <div class="trade-buttons">
      <button class="buy-crypto-button" id="buyCrypto">–ö—É–ø–∏—Ç—å MEC</button>
      <button class="sell-crypto-button" id="sellCrypto">–ü—Ä–æ–¥–∞—Ç—å MEC</button>
    </div>
    
    <div style="margin-top: 15px;">
      <input type="number" id="tradeAmount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ MEC" min="1" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #FFD700; background: rgba(255,255,255,0.1); color: white;">
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <button class="close-button" id="closeSettings">&times;</button>
    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
    
    <div class="settings-item">
      <label>–ó–≤—É–∫–∏:</label>
      <input type="checkbox" id="soundEnabled" checked>
    </div>
    
    <div class="settings-item">
      <label>–í–∏–±—Ä–∞—Ü–∏—è:</label>
      <input type="checkbox" id="vibrationEnabled" checked>
    </div>
    
    <div class="settings-item">
      <label>–ê–≤—Ç–æ-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</label>
      <input type="checkbox" id="autoSaveEnabled" checked>
    </div>
    
    <button class="reset-button" onclick="resetGame()" style="margin-top: 20px;">–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
  </div>
</div>

<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
  const tg = window.Telegram.WebApp;
  tg.expand();
  tg.ready();

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userAvatar = document.getElementById('userAvatar');
  const defaultAvatar = document.getElementById('defaultAvatar');
  
  if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
    const user = tg.initDataUnsafe.user;
    if (user.photo_url) {
      userAvatar.src = user.photo_url;
      userAvatar.style.display = 'block';
      defaultAvatar.style.display = 'none';
    }
  }

  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
  let coins = parseInt(localStorage.getItem('gameCoins')) || 0;
  let boostMultiplier = parseInt(localStorage.getItem('boostMultiplier')) || 1;
  let currentSkin = localStorage.getItem('currentSkin') || 'default';
  let ownedSkins = JSON.parse(localStorage.getItem('ownedSkins')) || ['default'];
  let cryptoAmount = parseInt(localStorage.getItem('cryptoAmount')) || 0;
  
  // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞
  let priceHistory = JSON.parse(localStorage.getItem('priceHistory')) || [1.00];
  let currentPrice = priceHistory[priceHistory.length - 1];

  // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
  const scoreElement = document.getElementById('score');
  const tapButton = document.getElementById('tapButton');
  const coinsElement = document.getElementById('coins');
  const cryptoAmountElement = document.getElementById('cryptoAmount');
  const boostLevelElement = document.getElementById('boostLevel');
  const currentSkinElement = document.getElementById('currentSkin');
  const resetButton = document.getElementById('resetButton');
  const shopButton = document.getElementById('shopButton');
  const rouletteButton = document.getElementById('rouletteButton');
  const chartButton = document.getElementById('chartButton');
  const shopModal = document.getElementById('shopModal');
  const rouletteModal = document.getElementById('rouletteModal');
  const chartModal = document.getElementById('chartModal');
  const settingsModal = document.getElementById('settingsModal');
  const closeShop = document.getElementById('closeShop');
  const closeRoulette = document.getElementById('closeRoulette');
  const closeChart = document.getElementById('closeChart');
  const closeSettings = document.getElementById('closeSettings');
  const spinButton = document.getElementById('spinButton');
  const rouletteResult = document.getElementById('rouletteResult');
  const userAvatarElement = document.getElementById('userAvatar');
  const defaultAvatarElement = document.getElementById('defaultAvatar');

  // –°–∫–∏–Ω—ã
  const skins = {
    'default': { name: '–û–±—ã—á–Ω—ã–π', class: '', price: 0 },
    'diamond': { name: '–ê–ª–º–∞–∑–Ω—ã–π', class: 'diamond', price: 5000 },
    'ruby': { name: '–†—É–±–∏–Ω–æ–≤—ã–π', class: 'ruby', price: 8000 },
    'emerald': { name: '–ò–∑—É–º—Ä—É–¥–Ω—ã–π', class: 'emerald', price: 12000 },
    'bitcoin': { name: '–ë–∏—Ç–∫–æ–∏–Ω', class: 'bitcoin', price: 20000 },
    'crown': { name: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π', class: 'crown', price: 50000 }
  };

  // –ü—Ä–∏–∑—ã —Ä—É–ª–µ—Ç–∫–∏
  const roulettePrizes = [
    { type: 'coins', amount: 100, chance: 25 },
    { type: 'coins', amount: 250, chance: 20 },
    { type: 'coins', amount: 500, chance: 15 },
    { type: 'coins', amount: 1000, chance: 10 },
    { type: 'coins', amount: 2500, chance: 5 },
    { type: 'coins', amount: 5000, chance: 3 },
    { type: 'coins', amount: 10000, chance: 1 },
    { type: 'skin', chance: 10 },
    { type: 'nothing', chance: 11 }
  ];

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  function updateDisplay() {
    scoreElement.textContent = coins + ' –º–æ–Ω–µ—Ç';
    coinsElement.textContent = coins;
    cryptoAmountElement.textContent = cryptoAmount;
    boostLevelElement.textContent = boostMultiplier + 'x';
    currentSkinElement.textContent = skins[currentSkin].name;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Å–∫–∏–Ω
    applySkin(currentSkin);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫
    updateShopButtons();
  }

  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–Ω–∞
  function applySkin(skin) {
    tapButton.className = 'coin-button';
    if (skin !== 'default') {
      tapButton.classList.add(skins[skin].class);
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞
  function updateShopButtons() {
    // –£—Å–∏–ª–∏—Ç–µ–ª–∏
    document.getElementById('buyBoost2').disabled = coins < 1000;
    document.getElementById('buyBoost5').disabled = coins < 5000;
    document.getElementById('buyBoost10').disabled = coins < 10000;
    document.getElementById('buyBoost25').disabled = coins < 25000;
    document.getElementById('buyBoost50').disabled = coins < 50000;
    
    // –°–∫–∏–Ω—ã
    document.getElementById('buySkinDiamond').disabled = coins < 5000 || ownedSkins.includes('diamond');
    document.getElementById('buySkinRuby').disabled = coins < 8000 || ownedSkins.includes('ruby');
    document.getElementById('buySkinEmerald').disabled = coins < 12000 || ownedSkins.includes('emerald');
    document.getElementById('buySkinBitcoin').disabled = coins < 20000 || ownedSkins.includes('bitcoin');
    document.getElementById('buySkinCrown').disabled = coins < 50000 || ownedSkins.includes('crown');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Å–∫–∏–Ω–æ–≤
    updateSkinButtons();
    
    // –†—É–ª–µ—Ç–∫–∞
    spinButton.disabled = coins < 500;
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å–∫–∏–Ω–æ–≤
  function updateSkinButtons() {
    const skinButtons = {
      'diamond': document.getElementById('buySkinDiamond'),
      'ruby': document.getElementById('buySkinRuby'),
      'emerald': document.getElementById('buySkinEmerald'),
      'bitcoin': document.getElementById('buySkinBitcoin'),
      'crown': document.getElementById('buySkinCrown')
    };

    for (const [skin, button] of Object.entries(skinButtons)) {
      if (ownedSkins.includes(skin)) {
        button.textContent = '‚úì –ö—É–ø–ª–µ–Ω–æ';
        button.disabled = true;
        if (currentSkin === skin) {
          button.innerHTML = '‚úì –í—ã–±—Ä–∞–Ω–æ <span class="owned">‚òÖ</span>';
        } else {
          button.innerHTML = '‚úì –í—ã–±—Ä–∞—Ç—å —Å–∫–∏–Ω';
          button.disabled = false;
          button.onclick = () => selectSkin(skin);
        }
      }
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞
  function handleClick() {
    coins += boostMultiplier;
    localStorage.setItem('gameCoins', coins);
    updateDisplay();

    // –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–Ω–µ—Ç—ã
    tapButton.style.transform = 'scale(0.95) rotate(5deg)';
    setTimeout(() => {
      tapButton.style.transform = 'scale(1) rotate(0deg)';
    }, 100);
  }

  // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞
  function resetGame() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —Å–±—Ä–æ—Å–∏—Ç –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å!')) {
      coins = 0;
      boostMultiplier = 1;
      currentSkin = 'default';
      ownedSkins = ['default'];
      cryptoAmount = 0;
      priceHistory = [1.00];
      currentPrice = 1.00;
      localStorage.clear();
      updateDisplay();
      updateChart();
    }
  }

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
  function openShop() {
    shopModal.style.display = 'block';
    updateShopButtons();
  }

  function closeShopModal() {
    shopModal.style.display = 'none';
  }

  function openRoulette() {
    rouletteModal.style.display = 'block';
    updateShopButtons();
  }

  function closeRouletteModal() {
    rouletteModal.style.display = 'none';
  }

  function openChart() {
    chartModal.style.display = 'block';
    updateChart();
  }

  function closeChartModal() {
    chartModal.style.display = 'none';
  }

  function openSettings() {
    settingsModal.style.display = 'block';
  }

  function closeSettingsModal() {
    settingsModal.style.display = 'none';
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —É—Å–∏–ª–∏—Ç–µ–ª—è
  function buyBoost(multiplier, cost) {
    if (coins >= cost) {
      coins -= cost;
      boostMultiplier = multiplier;
      localStorage.setItem('gameCoins', coins);
      localStorage.setItem('boostMultiplier', boostMultiplier);
      updateDisplay();
      alert(`üéâ –£—Å–∏–ª–∏—Ç–µ–ª—å ${multiplier}x –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ —Å–∫–∏–Ω–∞
  function buySkin(skin) {
    const skinData = skins[skin];
    if (coins >= skinData.price && !ownedSkins.includes(skin)) {
      coins -= skinData.price;
      ownedSkins.push(skin);
      localStorage.setItem('gameCoins', coins);
      localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
      selectSkin(skin);
      updateDisplay();
      alert(`üéâ –°–∫–∏–Ω "${skinData.name}" –∫—É–ø–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!`);
    }
  }

  // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ —Å–∫–∏–Ω–∞
  function selectSkin(skin) {
    if (ownedSkins.includes(skin)) {
      currentSkin = skin;
      localStorage.setItem('currentSkin', skin);
      updateDisplay();
    }
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
  function spinRoulette() {
    if (coins < 500) return;

    coins -= 500;
    localStorage.setItem('gameCoins', coins);

    // –í—ã–±–æ—Ä –ø—Ä–∏–∑–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–Ω—Å–æ–≤
    let random = Math.random() * 100;
    let cumulativeChance = 0;
    let prize = null;

    for (const p of roulettePrizes) {
      cumulativeChance += p.chance;
      if (random <= cumulativeChance) {
        prize = p;
        break;
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–∑–∞
    let message = '';
    if (prize.type === 'coins') {
      coins += prize.amount;
      message = `üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${prize.amount} –º–æ–Ω–µ—Ç!`;
    } else if (prize.type === 'skin') {
      const availableSkins = Object.keys(skins).filter(skin => 
        skin !== 'default' && !ownedSkins.includes(skin)
      );
      
      if (availableSkins.length > 0) {
        const randomSkin = availableSkins[Math.floor(Math.random() * availableSkins.length)];
        ownedSkins.push(randomSkin);
        message = `üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Å–∫–∏–Ω "${skins[randomSkin].name}"!`;
        if (confirm(message + '\n\n–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å?')) {
          selectSkin(randomSkin);
        }
      } else {
        const bonusCoins = 5000;
        coins += bonusCoins;
        message = `üéâ –í—Å–µ —Å–∫–∏–Ω—ã —É–∂–µ –µ—Å—Ç—å! –ë–æ–Ω—É—Å: ${bonusCoins} –º–æ–Ω–µ—Ç!`;
      }
    } else {
      message = 'üòî –ü–æ–≤–µ–∑–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!';
    }

    localStorage.setItem('gameCoins', coins);
    localStorage.setItem('ownedSkins', JSON.stringify(ownedSkins));
    
    rouletteResult.innerHTML = `<div class="roulette-prize">${message}</div>`;
    updateDisplay();
  }

  // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
  function updatePrice() {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –æ—Ç -0.5 –¥–æ +0.5
    const change = (Math.random() - 0.5) * 0.1;
    currentPrice = Math.max(0.1, currentPrice + change);
    priceHistory.push(currentPrice);
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 —Ç–æ—á–∫–∞–º–∏
    if (priceHistory.length > 50) {
      priceHistory.shift();
    }
    
    localStorage.setItem('priceHistory', JSON.stringify(priceHistory));
    updateChart();
  }

  function updateChart() {
    const canvas = document.getElementById('priceChart');
    const ctx = canvas.getContext('2d');
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
    
    // –û—á–∏—â–∞–µ–º canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // –ù–∞—Ö–æ–¥–∏–º min –∏ max —Ü–µ–Ω—ã –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
    const minPrice = Math.min(...priceHistory);
    const maxPrice = Math.max(...priceHistory);
    const priceRange = maxPrice - minPrice || 1;
    
    // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
    ctx.beginPath();
    ctx.strokeStyle = currentPrice >= priceHistory[priceHistory.length - 2] ? '#4CAF50' : '#f44336';
    ctx.lineWidth = 2;
    
    priceHistory.forEach((price, index) => {
      const x = (index / (priceHistory.length - 1)) * canvas.width;
      const y = canvas.height - ((price - minPrice) / priceRange) * canvas.height;
      
      if (index === 0) {
        ctx.moveTo(x, y);
      } else {
        ctx.lineTo(x, y);
      }
    });
    
    ctx.stroke();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–µ–Ω–µ
    const priceChange = ((currentPrice - priceHistory[priceHistory.length - 2]) / priceHistory[priceHistory.length - 2] * 100) || 0;
    document.getElementById('currentPrice').textContent = currentPrice.toFixed(2);
    document.getElementById('priceChange').textContent = priceChange.toFixed(2);
    document.getElementById('priceChange').className = priceChange >= 0 ? 'price-up' : 'price-down';
    
    document.getElementById('cryptoBalance').textContent = cryptoAmount;
    document.getElementById('cryptoValue').textContent = (cryptoAmount * currentPrice).toFixed(2);
  }

  function buyCrypto() {
    const amount = parseInt(document.getElementById('tradeAmount').value) || 0;
    const cost = amount * currentPrice;
    
    if (amount > 0 && coins >= cost) {
      coins -= cost;
      cryptoAmount += amount;
      localStorage.setItem('gameCoins', coins);
      localStorage.setItem('cryptoAmount', cryptoAmount);
      updateDisplay();
      updateChart();
      alert(`‚úÖ –ö—É–ø–ª–µ–Ω–æ ${amount} MEC –∑–∞ ${cost.toFixed(2)} –º–æ–Ω–µ—Ç`);
    } else {
      alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
    }
  }

  function sellCrypto() {
    const amount = parseInt(document.getElementById('tradeAmount').value) || 0;
    
    if (amount > 0 && cryptoAmount >= amount) {
      const earnings = amount * currentPrice;
      coins += earnings;
      cryptoAmount -= amount;
      localStorage.setItem('gameCoins', coins);
      localStorage.setItem('cryptoAmount', cryptoAmount);
      updateDisplay();
      updateChart();
      alert(`‚úÖ –ü—Ä–æ–¥–∞–Ω–æ ${amount} MEC –∑–∞ ${earnings.toFixed(2)} –º–æ–Ω–µ—Ç`);
    } else {
      alert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ MEC –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
  tapButton.addEventListener('click', handleClick);
  resetButton.addEventListener('click', resetGame);
  shopButton.addEventListener('click', openShop);
  rouletteButton.addEventListener('click', openRoulette);
  chartButton.addEventListener('click', openChart);
  userAvatarElement.addEventListener('click', openSettings);
  defaultAvatarElement.addEventListener('click', openSettings);
  
  closeShop.addEventListener('click', closeShopModal);
  closeRoulette.addEventListener('click', closeRouletteModal);
  closeChart.addEventListener('click', closeChartModal);
  closeSettings.addEventListener('click', closeSettingsModal);
  
  spinButton.addEventListener('click', spinRoulette);
  document.getElementById('buyCrypto').addEventListener('click', buyCrypto);
  document.getElementById('sellCrypto').addEventListener('click', sellCrypto);

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –º–∞–≥–∞–∑–∏–Ω–∞
  document.getElementById('buyBoost2').addEventListener('click', () => buyBoost(2, 1000));
  document.getElementById('buyBoost5').addEventListener('click', () => buyBoost(5, 5000));
  document.getElementById('buyBoost10').addEventListener('click', () => buyBoost(10, 10000));
  document.getElementById('buyBoost25').addEventListener('click', () => buyBoost(25, 25000));
  document.getElementById('buyBoost50').addEventListener('click', () => buyBoost(50, 50000));

  document.getElementById('buySkinDiamond').addEventListener('click', () => buySkin('diamond'));
  document.getElementById('buySkinRuby').addEventListener('click', () => buySkin('ruby'));
  document.getElementById('buySkinEmerald').addEventListener('click', () => buySkin('emerald'));
  document.getElementById('buySkinBitcoin').addEventListener('click', () => buySkin('bitcoin'));
  document.getElementById('buySkinCrown').addEventListener('click', () => buySkin('crown'));

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
  window.addEventListener('click', (event) => {
    if (event.target === shopModal) closeShopModal();
    if (event.target === rouletteModal) closeRouletteModal();
    if (event.target === chartModal) closeChartModal();
    if (event.target === settingsModal) closeSettingsModal();
  });

  // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∞–ø–æ–≤ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
  tapButton.addEventListener('touchstart', function(e) {
    e.preventDefault();
    handleClick();
  });

  // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
  tapButton.addEventListener('click', function() {
    if (navigator.vibrate) navigator.vibrate(10);
  });

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
  setInterval(updatePrice, 10000);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  updateDisplay();
  updateChart();
</script>
</body>
</html>
